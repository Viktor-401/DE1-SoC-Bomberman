// Screen setting
const SCREEN_HEIGHT = 60;
const SCREEN_WIDTH = 80;

//
#define LEFT_BUTTON 1

// game settings
#define MAP_SIZE 21
const BOMB_TIMER = 50;
const DEFAULT_HP = 1;
const DEFAULT_BOMBS = 1;
const DEFAULT_POWER = 1;
const DEFAULT_VELOCITY = 1;
const STARTING_P1_X = 1;
const STARTING_P1_Y = 1;
const STARTING_P2_X = 19;
const STARTING_P2_Y = 19;
const COOLDOWN_INPUT = 10;
const INPUT_INCLINACAO = 65;
const INPUT_INCLINACAO_MOUSE = 10;

// Directions
#define SENSE 5 // Mouse sense
#define UP 0
#define DOWN 1
#define LEFT 2
#define RIGHT 3

// Cell Types
#define EMPTY_CELL 0
#define BLOCK 1
#define BARRIER 2
#define BOMB 3
#define ITEM 4
#define PLAYER1 5
#define PLAYER2 6

// Game Stats
#define ONGOING 0
#define DRAW 1
#define P1WINS 2
#define P2WINS 3

typedef struct Mouse
{
    int x;
    int y;
    int fdMouse;
} Mouse;

typedef struct Player
{
    // TODO Sprites
    int HP;
    int bombs;
    int power;
    int posX;
    int posY;
    int facingDirection;
} Player;

typedef struct Item
{
    int HP;
    int powerBoost;
    int increaseBombs;
    int speedBoost;
    int HPBoost;
} Item;

typedef struct Block
{
    int HP;
    Item item;
} Block;

typedef struct Bomb
{
    int timer;
    int power;
    Player *owner;
} Bomb;

typedef union Object
{
    Block block;
    Item item;
    Player player;
    Bomb bomb;
} Object;

typedef struct Cell
{
    int type;
    Object object;
} Cell;

typedef struct Map
{
    Cell matriz[MAP_SIZE][MAP_SIZE];
    int x;
    int y;

} Map;

// Colors
typedef struct Cor
{
    int R;
    int G;
    int B;
} Cor;

const Cor BLACK = {0, 0, 0};
const Cor GRAY = {7, 7, 7};
const Cor YELLOW = {7, 7, 0};
const Cor ORANGE = {7, 4, 1};
const Cor BLUE = {0, 0, 7};
const Cor CYAN = {0, 7, 7};
const Cor MAGENTA = {7, 0, 7};
const Cor GREEN = {0, 7, 0};
const Cor RED = {7, 0, 0};

const Cor *LISTA_CORES[9] = {&BLACK, &GRAY, &BLUE, &YELLOW, &ORANGE, &CYAN, &MAGENTA, &GREEN, &RED};
int mapLayout[MAP_SIZE][MAP_SIZE] = {
    {BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER},
    {BARRIER, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, BLOCK, EMPTY_CELL, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, EMPTY_CELL, BLOCK, EMPTY_CELL, BARRIER},
    {BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER},
    {BARRIER, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BARRIER},
    {BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER},
    {BARRIER, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BARRIER},
    {BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER},
    {BARRIER, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BARRIER},
    {BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER},
    {BARRIER, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BARRIER},
    {BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER},
    {BARRIER, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BARRIER},
    {BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER},
    {BARRIER, EMPTY_CELL, BLOCK, EMPTY_CELL, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, EMPTY_CELL, BLOCK, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, BLOCK, BARRIER, EMPTY_CELL, BARRIER},
    {BARRIER, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BLOCK, BLOCK, BLOCK, BLOCK, BLOCK, EMPTY_CELL, EMPTY_CELL, EMPTY_CELL, BARRIER},
    {BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER, BARRIER}};

// int titleMatriz[SCREEN_HEIGHT][SCREEN_WIDTH]=0

// int player [20][20] ={
// {0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007, 0007},
// {0007, 0777, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0777},
// {0007, 0777, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0777},
// {0007, 0777, 0700, 0777, 0700, 0700, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0700, 0700, 0777, 0700, 0777},
// {0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700},
// {0007, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700},
// {0007, 0700, 0007, 0777, 0007, 0700, 0007, 0700, 0007, 0777, 0007, 0777, 0007, 0700, 0007, 0700, 0007, 0777, 0007, 0700},
// {0007, 0700, 0700, 0777, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0700, 0777, 0700, 0700},
// {0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700},
// {0007, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777, 0777, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777},
// {0007, 0777, 0007, 0700, 0007, 0777, 0007, 0700, 0007, 0777, 0007, 0777, 0007, 0700, 0007, 0777, 0007, 0700, 0007, 0777},
// {0007, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777, 0777, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777},
// {0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700},
// {0007, 0700, 0700, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777, 0700, 0700},
// {0007, 0700, 0007, 0777, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0777, 0007, 0700},
// {0007, 0700, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0777, 0777, 0777, 0700, 0700, 0700, 0777, 0700, 0700, 0700, 0700},
// {0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700},
// {0007, 0777, 0700, 0777, 0700, 0700, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0700, 0700, 0777, 0700, 0777},
// {0007, 0777, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0700, 0007, 0777},
// {0007, 0777, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0777, 0700, 0700, 0700, 0700, 0700, 0777, 0777, 0777},
// };

int player2Sprite [20][20] =
{
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0700, 0700, 0700, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0700, 0700, 0700, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0777, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0777, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0111, 0531, 0531, 0531, 0531, 0531, 0531, 0531, 0111, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0111, 0531, 0531, 0531, 0531, 0531, 0531, 0531, 0111, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0777, 0777, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0777, 0777, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677},
};

int player1Sprite [20][20] =
{
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0007, 0007, 0007, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0007, 0007, 0007, 0777, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0777, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0777, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0111, 0531, 0531, 0531, 0531, 0531, 0531, 0531, 0111, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0531, 0111, 0777, 0531, 0531, 0531, 0777, 0111, 0531, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0777, 0111, 0111, 0531, 0531, 0531, 0531, 0531, 0531, 0531, 0111, 0111, 0777, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0777, 0777, 0111, 0111, 0111, 0111, 0111, 0111, 0111, 0777, 0777, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0777, 0777, 0777, 0777, 0777, 0777, 0777, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677}, 
    {0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677, 0677},
};

